<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéß YT Song Downloader</title>
<style>
    html, body { margin:0; padding:0; height:100%; background:#000; color:#0f0; font-family:"Courier New", monospace; overflow:hidden; }
    canvas#dots { position:fixed; top:0; left:0; width:100%; height:100%; display:block; z-index:0; background:#000; }
    .terminal { position:relative; z-index:2; width:90%; max-width:500px; background:rgba(0,0,0,0.85); border:2px solid #0f0; border-radius:10px; padding:20px; margin:auto; margin-top:6vh; box-shadow:0 0 20px #0f0; }
    h1 { text-align:center; color:#0f0; text-shadow:0 0 10px #0f0; font-size:1.2rem; margin-bottom:20px; }
    input { width:100%; background:#000; border:1px solid #0f0; color:#0f0; padding:10px; border-radius:5px; margin-bottom:15px; font-size:1rem; }
    .buttons { display:flex; justify-content:space-between; }
    button { background:transparent; border:1px solid #0f0; color:#0f0; padding:10px; width:48%; border-radius:5px; cursor:pointer; transition:0.2s; }
    button:hover { background:#0f0; color:#000; }
    #output { margin-top:20px; background:#000; padding:10px; border-radius:5px; min-height:60px; font-size:0.9rem; }
    #preview { text-align:center; margin-top:15px; }
    #preview img { width:100%; border-radius:8px; border:1px solid #0f0; margin-bottom:10px; }
    #preview h3 { color:#0f0; font-size:1rem; }
    .cursor { animation: blink 1s infinite; }
    @keyframes blink { 0%,50%{opacity:1;} 51%,100%{opacity:0;} }
</style>
</head>
<body>
<canvas id="dots"></canvas>
<div class="terminal">
<h1>üéß YT Song Downloader</h1>
<input type="text" id="songName" placeholder="Enter song name here...">
<div class="buttons">
  <button onclick="fetchSong()">Search</button>
</div>
<div id="preview"></div>
<div id="output">> Ready... <span class="cursor">‚ñà</span></div>
<div class="buttons" id="downloadBtns" style="display:none; margin-top:15px;">
  <button onclick="downloadSong('audio')">üéß Audio</button>
  <button onclick="downloadSong('document')">üìÇ Document</button>
</div>
</div>

<script>
/* === Animated Dots Background === */
const canvas = document.getElementById("dots");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const dots = [];
const maxDots = 35;
const maxDist = 120;
class Dot {
  constructor(){ this.x=Math.random()*canvas.width; this.y=Math.random()*canvas.height; this.vx=(Math.random()-0.5)*0.5; this.vy=(Math.random()-0.5)*0.5; this.size=2;}
  move(){this.x+=this.vx; this.y+=this.vy; if(this.x<0||this.x>canvas.width)this.vx*=-1; if(this.y<0||this.y>canvas.height)this.vy*=-1;}
  draw(){ctx.beginPath(); ctx.arc(this.x,this.y,this.size,0,Math.PI*2); ctx.fillStyle="#0f0"; ctx.fill();}
}
for(let i=0;i<maxDots;i++) dots.push(new Dot());
function animateDots(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let dot of dots){ dot.move(); dot.draw(); for(let other of dots){ const dx=dot.x-other.x; const dy=dot.y-other.y; const dist=Math.sqrt(dx*dx+dy*dy); if(dist<maxDist){ ctx.beginPath(); ctx.moveTo(dot.x,dot.y); ctx.lineTo(other.x,other.y); ctx.strokeStyle="rgba(0,255,0,"+(1-dist/maxDist)+")"; ctx.lineWidth=0.4; ctx.stroke(); } } }
  requestAnimationFrame(animateDots);
}
animateDots();
window.addEventListener("resize",()=>{canvas.width=window.innerWidth; canvas.height=window.innerHeight;});

/* === YT Song Search === */
let currentSong=null;
async function fetchSong(){
  const query = document.getElementById("songName").value.trim();
  const output = document.getElementById("output");
  const preview = document.getElementById("preview");
  const btns = document.getElementById("downloadBtns");
  if(!query){ output.innerHTML="> Please enter a song name <span class='cursor'>‚ñà</span>"; return;}
  preview.innerHTML=""; btns.style.display="none";
  output.innerHTML="> Searching... <span class='cursor'>‚ñà</span>";
  
  try{
    const res = await fetch(`https://tharuzz-ofc-apis.vercel.app/api/search/ytsearch?query=${encodeURIComponent(query)}`);
    const data = await res.json();
    if(!data.result || data.result.length==0){ output.innerHTML="> No results found ‚ö†Ô∏è"; return;}
    const song = data.result[0];
    currentSong = song;
    preview.innerHTML=`<img src="${song.image||song.thumbnail}" alt="thumbnail"><h3>${song.title}</h3>`;
    btns.style.display="flex";
    output.innerHTML="> Song info fetched ‚úÖ";
  }catch(e){ output.innerHTML="> Server error ‚ùå";}
}

async function downloadSong(type){
  if(!currentSong){ alert("Please search song first!"); return;}
  const output = document.getElementById("output");
  output.innerHTML="> Generating download link... <span class='cursor'>‚ñà</span>";
  try{
    const res = await fetch(`https://tharuzz-ofc-api-v3.vercel.app/api/ytdl/yt?url=${encodeURIComponent(currentSong.url)}&format=mp3`);
    const data = await res.json();
    if(!data.result || !data.result.download){ output.innerHTML="> Download failed ‚ùå"; return;}
    const a = document.createElement("a");
    a.href = data.result.download;
    a.download = currentSong.title+".mp3";
    if(type==="document") a.download = currentSong.title+".mp3";
    document.body.appendChild(a);
    a.click();
    a.remove();
    output.innerHTML="> Download started ‚úÖ";
  }catch(e){ output.innerHTML="> Server error ‚ùå";}
}
</script>
</body>
</html>
